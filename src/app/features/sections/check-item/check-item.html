<!-- htmlhint attr-lowercase:false -->
@let item = model();

<article
  class="check-item"
  uicard
  padding="m"
  variant="raised"
  data-ui="check-item"
  [attr.aria-labelledby]="'check-item-title-' + item.id"
  [ngClass]="{
    'check-item--ok': status() === 'ok',
    'check-item--na': status() === 'na',
    'check-item--def': status() === 'nok'
  }"
>
  <div class="check-item__row">
    <div class="check-item__num">{{ item.id }}</div>
    @if (editableTitle()) {
      <input
        class="check-item__title-input"
        type="text"
        [id]="'check-item-title-' + item.id"
        placeholder="Punkt benennen…"
        [value]="item.title"
        (input)="onTitleInput(item.id, $any($event.target).value)"
      />
    } @else {
      <h3 class="check-item__title" [id]="'check-item-title-' + item.id">
        {{ item.title }}
      </h3>
    }
    <div
      class="check-item__actions"
      data-ui="check-item-actions"
      role="group"
      [attr.aria-labelledby]="'check-item-title-' + item.id"
    >
      <button
        uibutton
        kind="success"
        size="s"
        icon
        type="button"
        aria-label="OK"
        [attr.aria-pressed]="status() === 'ok'"
        (click)="setStatus('ok')"
      >
        ✓
      </button>
      <button
        uibutton
        kind="warning"
        size="s"
        icon
        type="button"
        aria-label="N/A"
        [attr.aria-pressed]="status() === 'na'"
        (click)="setStatus('na')"
      >
        –
      </button>
      <button
        uibutton
        kind="danger"
        size="s"
        icon
        type="button"
        aria-label="NOK"
        [attr.aria-pressed]="status() === 'nok'"
        (click)="toggleNok()"
      >
        ✕
      </button>
    </div>
  </div>

  <div class="check-item__acc" [class.is-open]="isNokOpen()">
    @if (status() === 'nok' && isNokOpen()) {
      <app-textarea
        data-ui="check-item-note"
        label="Mängelbeschreibung"
        placeholder="Bitte Mangel beschreiben..."
        [value]="note()"
        (valueChange)="setNote(item.id, $event)"
      ></app-textarea>

      <div class="check-item__footer" data-ui="check-item-footer">
        @if (showMedia()) {
          <app-check-item-media [photos]="photos()" (photosChange)="setPhotos($event)"></app-check-item-media>
        }

        @if (showSaveButton()) {
          <div class="check-item__footer-actions">
            <button
              uibutton
              kind="success"
              size="s"
              type="button"
              [disabled]="!dirty()"
              (click)="save()"
              data-ui="check-item-save"
            >
              Speichern
            </button>
            <button
              uibutton
              kind="ghost"
              size="s"
              type="button"
              [disabled]="note().trim() === '' && photos().length === 0"
              (click)="clearDefect()"
              data-ui="check-item-clear"
            >
              Löschen
            </button>
          </div>
        }
      </div>
    }
  </div>
</article>
